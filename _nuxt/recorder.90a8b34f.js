import{u as J}from"./useDttkMeta.fa1b62f1.js";import{u as Q}from"./useEmitter.43e253ae.js";import{d as z,r as u,o as H,c as B,f as _,l as K,q as d,m as S,s as c,E as l,G as V,J as P,Q as $,k as X,v as x}from"./entry.64c9f3be.js";const Y={class:"mx-3"},Z={class:"d-flex align-center mb-3"},ee={class:"d-flex align-center"},ae={class:"d-flex align-center"},le=["muted"],ne=z({__name:"recorder",setup(te){J({title:"Media Recorder",description:"Online free media recorder. Record audio and video in the browser.",path:"/recorder"});const D=Q(),y=u(!0),r=u(!1),n=u("none"),k=u(!0),p=u([]),R=u(""),T=u(""),v=u(!1),h=u(!0),f=u(null),o=u(null),b=u(null),m=u(null),U=u(null),C=[];async function O(){var a;(a=o.value)==null||a.getTracks().map(e=>e.stop()),o.value=null;try{o.value=await navigator.mediaDevices.getDisplayMedia({audio:!0,video:!0})}catch(e){console.log(e),o.value=null,n.value="none"}g("video")}async function g(a){if(!k.value){U.value.srcObject=null;return}await W(a),U.value.srcObject=b.value}async function j(){if(b.value==null){D.emit("toast","No stream to record");return}v.value=!0,C.length=0,m.value=new MediaRecorder(b.value,o.value==null?void 0:{mimeType:"video/webm;codecs=vp9"}),m.value.ondataavailable=a=>{C.push(a.data)},m.value.onstop=()=>{var a=document.createElement("a");a.download=o.value==null?"recording.mp3":"recording.mp4",a.href=URL.createObjectURL(new Blob(C,o.value==null?{type:"audio/mpeg-3"}:void 0)),a.click()},m.value.start(),D.emit("toast","Recording started"),console.log(m.value.state)}function L(){var a,e;v.value=!1,(a=m.value)==null||a.stop(),console.log((e=m.value)==null?void 0:e.state),m.value=null}async function W(a){var w,i,M,N;await q(),["audio","all"].includes(a)&&((w=f.value)==null||w.getTracks().map(s=>s.stop()),f.value=null,r.value&&(f.value=await navigator.mediaDevices.getUserMedia({audio:{deviceId:{exact:p.value.filter(s=>s.label==R.value)[0].deviceId}}}))),["video","all"].includes(a)&&(n.value!="screen"&&((i=o.value)==null||i.getTracks().map(s=>s.stop()),o.value=null),n.value=="camera"&&(o.value=await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:p.value.filter(s=>s.label==T.value)[0].deviceId}}})));let e=new MediaStream;(M=f.value)==null||M.getTracks().map(s=>e.addTrack(s)),(N=o.value)==null||N.getTracks().map(s=>e.addTrack(s)),b.value=e.getTracks().length==0?null:e}async function q(){if(!y.value||!r.value&&n.value!="camera")return;(p.value.length==0||p.value.some(e=>e.label==""))&&D.emit("toast","Refreshing device list...");let a=await navigator.mediaDevices.enumerateDevices();if(a.some(e=>e.label==""))try{y.value=!1,(await navigator.mediaDevices.getUserMedia({audio:r.value,video:n.value=="camera"})).getTracks().map(e=>e.stop()),a=await navigator.mediaDevices.enumerateDevices()}catch{D.emit("toast","Failed to get media devices."),r.value=!1,n.value="screen",y.value=!0;return}p.value=a,R.value=E.value[0]||"",T.value=I.value[0]||"",y.value=!0,D.emit("toast","Device list refreshed")}function A(){var a,e,w;r.value=!1,n.value="none",k.value=!0,h.value=!0,(a=o.value)==null||a.getTracks().map(i=>i.stop()),o.value=null,(e=f.value)==null||e.getTracks().map(i=>i.stop()),f.value=null,(w=b.value)==null||w.getTracks().map(i=>i.stop()),b.value=null}H(()=>{g("all")});const E=B(()=>p.value.filter(a=>a.kind.startsWith("audio")).map(a=>a.label)),I=B(()=>p.value.filter(a=>a.kind.startsWith("video")).map(a=>a.label));return(a,e)=>{const w=_("v-alert"),i=_("v-btn"),M=_("v-btn-toggle"),N=_("v-select"),s=_("v-checkbox"),F=_("v-card-text"),G=_("v-card");return X(),K("div",Y,[d(w,{type:"info",closable:"",text:"The recording is handled by the local browser and will not be uploaded to any server.",class:"mb-3",density:"compact",variant:"tonal"}),S("div",Z,[d(M,{mandatory:"",modelValue:l(r),"onUpdate:modelValue":[e[0]||(e[0]=t=>V(r)?r.value=t:null),e[1]||(e[1]=t=>g("audio"))],disabled:l(v)},{default:c(()=>[d(i,{value:!1,disabled:!l(r),"prepend-icon":"mdi-microphone-off"},{default:c(()=>[x(" No Mic ")]),_:1},8,["disabled"]),d(i,{value:!0,disabled:l(r),"prepend-icon":"mdi-microphone"},{default:c(()=>[x(" Enable Mic ")]),_:1},8,["disabled"])]),_:1},8,["modelValue","disabled"]),d(N,{label:"Microphone Device",items:l(E),modelValue:l(R),"onUpdate:modelValue":[e[2]||(e[2]=t=>V(R)?R.value=t:null),e[3]||(e[3]=t=>g("audio"))],variant:"outlined",density:"compact","hide-details":"",disabled:!l(r)||l(v),class:"ml-3"},null,8,["items","modelValue","disabled"])]),S("div",ee,[d(M,{divided:"",mandatory:"",modelValue:l(n),"onUpdate:modelValue":[e[4]||(e[4]=t=>V(n)?n.value=t:null),e[5]||(e[5]=t=>g("video"))],disabled:l(v),class:"mr-3"},{default:c(()=>[d(i,{value:"none",disabled:l(n)=="none","prepend-icon":"mdi-video-off"},{default:c(()=>[x(" No Video ")]),_:1},8,["disabled"]),d(i,{value:"screen",disabled:l(n)=="screen","prepend-icon":"mdi-monitor",onClick:O},{default:c(()=>[x(" Record Screen ")]),_:1},8,["disabled"]),d(i,{value:"camera",disabled:l(n)=="camera","prepend-icon":"mdi-camera"},{default:c(()=>[x(" Camera ")]),_:1},8,["disabled"])]),_:1},8,["modelValue","disabled"]),d(N,{label:"Camera Device",items:l(I),modelValue:l(T),"onUpdate:modelValue":[e[6]||(e[6]=t=>V(T)?T.value=t:null),e[7]||(e[7]=t=>g("video"))],variant:"outlined",density:"compact","hide-details":"",disabled:l(v)||l(n)!="camera"},null,8,["items","modelValue","disabled"])]),S("div",ae,[d(i,{color:"primary",disabled:!l(y)||l(b)==null,onClick:e[8]||(e[8]=t=>l(v)?L():j()),text:l(v)?"Stop Recording":l(o)?"Start Recording (mp4)":l(f)?"Start Recording (mp3)":"Start Recording","prepend-icon":l(v)?"mdi-stop":"mdi-record"},null,8,["disabled","text","prepend-icon"]),d(i,{class:"ml-3",onClick:A,text:"Reset","prepend-icon":"mdi-restart"}),d(s,{label:"Preview",modelValue:l(k),"onUpdate:modelValue":[e[9]||(e[9]=t=>V(k)?k.value=t:null),e[10]||(e[10]=t=>g("all"))],class:"ml-3",disabled:!l(y),"hide-details":"",style:{"flex-grow":"0"}},null,8,["modelValue","disabled"]),d(s,{label:"Mute Preview",modelValue:l(h),"onUpdate:modelValue":e[11]||(e[11]=t=>V(h)?h.value=t:null),class:"ml-3",style:{"flex-grow":"0"},"hide-details":""},null,8,["modelValue"])]),P(S("div",null,[P(d(G,{style:{width:"100%"}},{default:c(()=>[d(F,null,{default:c(()=>[x(" No preview available. Please select a video source. ")]),_:1})]),_:1},512),[[$,l(o)==null]]),P(S("video",{autoplay:"",ref_key:"preview",ref:U,muted:l(h),style:{width:"100%"}},null,8,le),[[$,l(o)!=null]])],512),[[$,l(k)]])])}}});export{ne as default};
